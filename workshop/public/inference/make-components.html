<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: https://ogp.me/ns# fb: https://ogp.me/ns/fb#">
<html lang="en" class="js csstransforms3d">
<head>
  <meta charset="utf-8">
  <meta property="og:title" content="AWS Computer Vision at the Edge Workshop" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="generator" content="Hugo 0.82.0" />
  <meta name="description" content="AWS Computer Vision at the Edge Workshop">
<meta name="author" content="Amazon AWS">

  <link rel="shortcut icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />
<link rel="icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />

  <title>Create the Inference Components :: AWS Computer Vision at the Edge Workshop</title>

  
  <link href="../css/nucleus.css" rel="stylesheet">
  <link href="../css/fontawesome-all.min.css" rel="stylesheet">
  <link href="../css/hybrid.css" rel="stylesheet">
  <link href="../css/featherlight.min.css" rel="stylesheet">
  <link href="../css/perfect-scrollbar.min.css" rel="stylesheet">
  <link href="../css/auto-complete.css" rel="stylesheet">
  <link href="../css/atom-one-dark-reasonable.css" rel="stylesheet">
  <link href="../css/theme.css" rel="stylesheet">
  <link href="../css/hugo-theme.css" rel="stylesheet">
  
  <link href="../css/theme-aws.css" rel="stylesheet">
  

  <script src="../js/jquery-3.5.1.min.js"></script>

  <style>
    :root #header + #content > #left > #rlblock_left{
        display:none !important;
    }
    
      :not(pre) > code + span.copy-to-clipboard {
          display: none;
      }
    
  </style>
  
</head>

<body class="" data-url="../inference/make-components.html">
  <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div>
    <a href="../" title="Go home">
        <img style="vertical-align:middle" src="https://fonts.workshops.aws/logos/logo.png" height="70px" />
    </a>
</div>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../js/lunr.min.js"></script>
<script type="text/javascript" src="../js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="../js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/setup-nvidia-device.html" title="Setup nVidia Device" class="dd-item 
        
        
        
        ">
      <a href="../setup-nvidia-device.html">
          Setup nVidia Device
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/setup-nvidia-device/nano.html" title="Jetson Nano" class="dd-item 
        
        
        
        ">
      <a href="../setup-nvidia-device/nano.html">
          Jetson Nano
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/setup-nvidia-device/install-tools.html" title="Install Tools" class="dd-item 
        
        
        
        ">
      <a href="../setup-nvidia-device/install-tools.html">
          Install Tools
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/greengrass-v2.html" title="Install Greengrass V2" class="dd-item 
        
        
        
        ">
      <a href="../greengrass-v2.html">
          Install Greengrass V2
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/greengrass-v2/install.html" title="Install" class="dd-item 
        
        
        
        ">
      <a href="../greengrass-v2/install.html">
          Install
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/greengrass-v2/validate.html" title="Validate" class="dd-item 
        
        
        
        ">
      <a href="../greengrass-v2/validate.html">
          Validate
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/inference.html" title="Add Inference" class="dd-item 
        parent
        
        
        ">
      <a href="../inference.html">
          Add Inference
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/inference/make-components.html" title="Create the Inference Components" class="dd-item 
        parent
        active
        
        ">
      <a href="../inference/make-components.html">
          Create the Inference Components
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/inference/deploy.html" title="Deploy and Monitor" class="dd-item 
        
        
        
        ">
      <a href="../inference/deploy.html">
          Deploy and Monitor
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/shortcodes.html" title="Shortcodes" class="dd-item 
        
        
        
        ">
      <a href="../shortcodes.html">
          <b>3. </b>Shortcodes
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/shortcodes/attachments.html" title="Attachments" class="dd-item 
        
        
        
        ">
      <a href="../shortcodes/attachments.html">
          Attachments
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/shortcodes/button.html" title="Button" class="dd-item 
        
        
        
        ">
      <a href="../shortcodes/button.html">
          Button
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/shortcodes/children.html" title="Children" class="dd-item 
        
        
        
        ">
      <a href="../shortcodes/children.html">
          Children
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
             
            
          
             
            
          
             
            
          
             
            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/shortcodes/expand.html" title="Expand" class="dd-item 
        
        
        
        ">
      <a href="../shortcodes/expand.html">
          Expand
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/shortcodes/img.html" title="Image" class="dd-item 
        
        
        
        ">
      <a href="../shortcodes/img.html">
          Image
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/shortcodes/notice.html" title="Notice" class="dd-item 
        
        
        
        ">
      <a href="../shortcodes/notice.html">
          Notice
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/shortcodes/siteparam.html" title="Site param" class="dd-item 
        
        
        
        ">
      <a href="../shortcodes/siteparam.html">
          Site param
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/shortcodes/siteurl.html" title="Site URL" class="dd-item 
        
        
        
        ">
      <a href="../shortcodes/siteurl.html">
          Site URL
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/shortcodes/youtube.html" title="Youtube" class="dd-item 
        
        
        
        ">
      <a href="../shortcodes/youtube.html">
          Youtube
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/launch.html" title="Launch" class="dd-item 
        
        
        
        ">
      <a href="../launch.html">
          <b>4. </b>Launch
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/launch/metadata.html" title="Metadata" class="dd-item 
        
        
        
        ">
      <a href="../launch/metadata.html">
          Metadata
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <left>

    <a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | © 2021, Amazon Web Services, Inc. or its affiliates. All rights reserved. 

</left>

    </section>
  </div>
</nav>





  <section id="body">
    <div id="overlay"></div>
    <div class="padding highlightable">
      
      <div>
        <div id="top-bar">
          
          
          <div id="breadcrumbs" itemscope="" itemtype="https://data-vocabulary.org/Breadcrumb">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                <i class="fa fa-bars"></i>
              </a>
            </span>
            
            <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
            
            <span class="links">
              
          
          
          
          
          
          
          
          
          
          
          <a href='../'>AWS Computer Vision at the Edge Workshop</a> > <a href='../inference.html'>Add Inference</a> > Create the Inference Components
          
          
          
          
          
          
            </span>
          </div>
          
          <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#step-1-clone-the-repository">Step 1: Clone the repository</a></li>
        <li><a href="#step-2-zip-and-upload-artifacts-to-s3">Step 2: Zip and upload artifacts to S3</a></li>
        <li><a href="#step-3-create-the-components">Step 3: Create the components</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

          
        </div>
      </div>
      

      
        <div id="body-inner">
          <h1>Create the Inference Components</h1>
          
          


	<p>Inference on the device is implemented with THREE components:</p>
<ul>
<li><code>variant.Jetson.DLR</code> provides the Deep Learning Runtime (DLR) libraries needed to run the models on the target device</li>
<li><code>variant.Jetson.ImageClassification.ModelStore</code> delivers the collection (or zoo) of Image Classifications models that will be used</li>
<li><code>aws.greengrass.JetsonDLRImageClassification</code> is the actual &lsquo;app&rsquo; that runs the inference model on the device</li>
</ul>
<p>The recipes and artifacts have been pre-created and stored in the Github repository:</p>
<p><a href="https://github.com/scottrfrancis/aws-iot-greengrass-v2-deploy-nvidia-deepstream">https://github.com/scottrfrancis/aws-iot-greengrass-v2-deploy-nvidia-deepstream</a></p>
<h3 id="step-1-clone-the-repository">Step 1: Clone the repository</h3>
<ol>
<li>On your <strong>development host</strong>, clone the repository</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd ~

git clone git@github.com:scottrfrancis/aws-iot-greengrass-v2-deploy-nvidia-deepstream.git
</code></pre></div><ol start="2">
<li>Observe you have the artifacts and recipe files in an arrangement like this:</li>
</ol>
<pre><code>.
├── artifacts
│   ├── aws.greengrass.JetsonDLRImageClassification
│   │   ├── 1.0.0
│   │   │   ├── inference.py
│   │   │   ├── init.sh
│   │   │   ├── IPCUtils.py
│   │   │   ├── jetson_inference.py
│   │   │   ├── labels.py
│   │   │   └── samples_images
│   │   │       ├── dog.jpg
│   │   │       └── dog.npy
│   ├── variant.Jetson.DLR
│   │   └── 1.0.0
│   │       ├── installer.sh
│   │       └── LICENSE
│   └── variant.Jetson.ImageClassification.ModelStore
│       ├── 0.1.1
│           ├── resnet18_v1-jetson_nano
│           │   ├── compiled.meta
│           │   ├── compiled_model.json
│           │   ├── compiled.params
│           │   ├── compiled.so
│           │   ├── dlr.h
│           │   ├── libdlr.so
│           │   └── manifest
│           ├── resnet18_v1-jetson_tx2
│           │   ├── compiled.meta
│           │   ├── compiled_model.json
│           │   ├── compiled.params
│           │   ├── compiled.so
│           │   ├── dlr.h
│           │   ├── libdlr.so
│           │   └── manifest
│           └── resnet18_v1-jetson_xavier
│               ├── compiled.meta
│               ├── compiled_model.json
│               ├── compiled.params
│               ├── compiled.so
│               ├── dlr.h
│               ├── libdlr.so
│               └── manifest
└── recipes
    ├── aws.greengrass.JetsonDLRImageClassification-1.0.0.json
    ├── variant.Jetson.DLR-1.0.0.json
    └── variant.Jetson.ImageClassification.ModelStore-1.0.0.json

14 directories, 47 files
</code></pre><h3 id="step-2-zip-and-upload-artifacts-to-s3">Step 2: Zip and upload artifacts to S3</h3>
<ol>
<li>Zip the artifacts for each component</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
cd ~/aws-iot-greengrass-v2-deploy-nvidia-deepstream/jetson_inference/artifacts

cd variant.Jetson.DLR/1.0.0/
zip -rm installer.zip *

cd ../..
cd variant.Jetson.ImageClassification.ModelStore/0.1.1/
zip -rm resnet18_v1-jetson.zip *

cd ../..
cd aws.greengrass.JetsonDLRImageClassification/1.0.0/
zip -rm image_classification.zip *
</code></pre></div><p>You should now have a zip file for each component like this</p>
<pre><code>.
├── aws.greengrass.JetsonDLRImageClassification
│   └── 1.0.0
│       └── image_classification.zip
├── variant.Jetson.DLR
│   └── 1.0.0
│       └── installer.zip
└── variant.Jetson.ImageClassification.ModelStore
    └── 0.1.1
        └── resnet18_v1-jetson.zip
</code></pre><ol start="2">
<li>Set the <code>bucket_name</code> environment variable for where you will host the artifact files. On your development <strong>host</strong>, extract your account number to an environment variable</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export region<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;us-west-2&#39;</span>
export acct_num<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws sts get-caller-identity --query <span style="color:#e6db74">&#34;Account&#34;</span> --output text<span style="color:#66d9ef">)</span>
export bucket_name<span style="color:#f92672">=</span>greengrass-component-artifacts-$acct_num-$region
</code></pre></div><p><strong>This bucket should have previously been created in the Greengrass installation lab</strong>. If this bucket does <strong>NOT</strong> exist, you can create it with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws s3 mb s3://$bucket_name
</code></pre></div><p><strong>NB-</strong> Alternatively, you can use an existing bucket. Set the environment variable <code>$bucket_name</code> for the remainder of this lab.</p>
<ol start="3">
<li>Copy the artifacts to the bucket</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd ~/aws-iot-greengrass-v2-deploy-nvidia-deepstream/jetson_inference/artifacts

aws s3 sync ./ s3://$bucket_name/artifacts/
</code></pre></div><p>Verify the layout of the artifacts in S3</p>

<figure>
	<img src="../inference/make-components/s3-artifacts.png?classes=shadow&width=60pc" alt="Artifacts in S3" />
</figure>
<h3 id="step-3-create-the-components">Step 3: Create the components</h3>
<ol>
<li>Modify the recipe files to use the bucket and artifacts you just uploaded</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd ~/aws-iot-greengrass-v2-deploy-nvidia-deepstream/jetson_inference/recipes

sed -i <span style="color:#e6db74">&#34;s/BUCKET_NAME/</span>$bucket_name<span style="color:#e6db74">/g&#34;</span> *.json
</code></pre></div><ol start="2">
<li>Create the components from the modified recipe files</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd ~/aws-iot-greengrass-v2-deploy-nvidia-deepstream/jetson_inference/recipes

aws greengrassv2 create-component-version --inline-recipe fileb://variant.Jetson.DLR-1.0.0.json
aws greengrassv2 create-component-version --inline-recipe fileb://variant.Jetson.ImageClassification.ModelStore-1.0.0.json
aws greengrassv2 create-component-version --inline-recipe fileb://aws.greengrass.JetsonDLRImageClassification-1.0.0.json
</code></pre></div><p>Verify the components are shown in the <a href="https://us-west-2.console.aws.amazon.com/iot/home?region=us-west-2#/greengrass/v2/cores" target="_blank" rel="noopener noreferrer">AWS IoT Management Console</a> under <strong>Greengrass</strong> and <strong>Components</strong>.</p>

<figure>
	<img src="../inference/make-components/components.png?classes=shadow&width=60pc" alt="Components" />
</figure>
<p><strong>Note</strong>: When the components are created, a integrity checksum is created for the artifacts and added to the recipe (view the recipe on the console to see the digest). Due to this, if you change an artifact, you must update the version for the component or recreate it.</p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../inference.html" title="Add Inference"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../inference/deploy.html" title="Deploy and Monitor" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../js/clipboard.min.js"></script>
    <script src="../js/perfect-scrollbar.min.js"></script>
    <script src="../js/perfect-scrollbar.jquery.min.js"></script>
    <script src="../js/jquery.sticky.js"></script>
    <script src="../js/featherlight.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../js/modernizr.custom-3.6.0.js"></script>
    <script src="../js/learn.js"></script>
    <script src="../js/hugo-learn.js"></script>
    
        
            <script src="../mermaid/mermaid.js"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    
  </body>
</html>
